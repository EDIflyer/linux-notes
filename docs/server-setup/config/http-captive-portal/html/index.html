<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Captive Portal Check</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f5f7fa;
      --card-bg: #ffffff;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --accent: #16a34a;
      --border: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100vh;
      overflow: hidden;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #e0f2fe, var(--bg));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--text-main);
    }

    .card {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      width: 520px;
      max-width: min(95vw, 520px);
      max-height: 95vh;
      overflow-y: auto;
      text-align: center;
    }

    .icon-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #bbf7d0, #16a34a);
      box-shadow: 0 10px 20px rgba(22, 163, 74, 0.4);
    }

    .icon-circle span {
      font-size: 2.75rem;
      color: #ecfdf3;
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 0.95rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.25rem 0 1rem;
      font-size: 0.875rem;
    }

    th,
    td {
      padding: 0.625rem 0.5rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }

    th {
      width: 38%;
      font-weight: 600;
      color: var(--text-muted);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    td {
      width: 62%;
      font-family: 'SF Mono', Menlo, Monaco, monospace;
      font-size: 0.875rem;
      word-break: normal;        /* do not break mid‑word */
      overflow-wrap: break-word; /* wrap on spaces/slashes */
    }

    .footnote {
      margin-top: 1.25rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: left;
      line-height: 1.4;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      font-size: 0.8rem;
      padding: 0.375rem 0.75rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      color: var(--text-muted);
      margin-top: 0.75rem;
    }

    .link-pill {
      font-size: 0.8rem;
      margin-top: 0.75rem;
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .link-pill a {
      text-decoration: none;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--text-main);
      font-size: 0.8rem;
      background: #f9fafb;
    }

    .link-pill a.active {
      background: #dbeafe;
      border-color: #60a5fa;
      color: #1d4ed8;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      .card {
        width: 95vw;
        padding: 1.75rem;
        margin: 0.5rem;
      }

      h1 {
        font-size: 1.4rem;
      }

      .icon-circle {
        width: 72px;
        height: 72px;
      }

      .icon-circle span {
        font-size: 2.5rem;
      }

      table {
        font-size: 0.85rem;
      }

      th,
      td {
        padding: 0.5rem 0.375rem;
      }
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="icon-circle">
      <span>✔</span>
    </div>
    <h1>Connection check successful</h1>
    <p class="subtitle">
      If your Wi‑Fi uses a login or splash page, it should be reachable now.
    </p>

    <table>
      <tr>
        <th>Client IP</th>
        <td id="client-ip">__CLIENT_IP__</td>
      </tr>
      <tr>
        <th>Server time (UTC)</th>
        <td id="server-time">__SERVER_TIME__</td>
      </tr>
      <tr>
        <th>Browser local time</th>
        <td id="browser-time">Detecting…</td>
      </tr>
      <tr>
        <th>Browser timezone</th>
        <td id="browser-tz">Detecting…</td>
      </tr>
      <tr>
        <th>Estimated location</th>
        <td id="geo-location">Looking up…</td>
      </tr>
      <tr>
        <th>Connection</th>
        <td id="connection-mode">Detecting…</td>
      </tr>
    </table>

    <div class="link-pill" id="protocol-links">
      <!-- JS will populate http/https links here -->
    </div>

    <div class="badge">
      Tip: if a login page doesn't appear, open a new tab and browse to any site.
    </div>

    <p class="footnote">
      Times are approximate. Location is a best‑effort estimate based on your IP address.
    </p>
  </div>

  <script>
    // Browser-local time (ISO 8601, correct sign relative to UTC)
    (function updateBrowserTime() {
      try {
        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');

        const offsetMinutes = now.getTimezoneOffset();
        // getTimezoneOffset() = UTC − local, in minutes:
        //  > 0 → local behind UTC  → offset is -HH:MM
        //  < 0 → local ahead UTC   → offset is +HH:MM
        let sign;
        if (offsetMinutes > 0) {
          sign = '-';
        } else if (offsetMinutes < 0) {
          sign = '+';
        } else {
          sign = '+';
        }

        const absMinutes = Math.abs(offsetMinutes);
        const hours = Math.floor(absMinutes / 60);
        const mins = absMinutes % 60;
        const offsetStr = sign + pad(hours) + ':' + pad(mins);

        const localIso = now.getFullYear() + '-' +
          pad(now.getMonth() + 1) + '-' +
          pad(now.getDate()) + 'T' +
          pad(now.getHours()) + ':' +
          pad(now.getMinutes()) + ':' +
          pad(now.getSeconds()) +
          offsetStr;

        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;

        document.getElementById("browser-time").textContent = localIso;
        document.getElementById("browser-tz").textContent = tz;
      } catch (e) {
        document.getElementById("browser-time").textContent = "Unavailable";
        document.getElementById("browser-tz").textContent = "Unavailable";
      }
    })();

    // IP geolocation (multiple CORS-friendly fallbacks)
    (function fetchGeo() {
      const el = document.getElementById("geo-location");
      el.textContent = "Looking up…";

      const apis = [
        'https://ipapi.co/json/',           // Primary (may rate limit)
        'https://api.country.is/'           // Backup (country only)
      ];

      function tryNext(apiIndex = 0) {
        if (apiIndex >= apis.length) {
          el.textContent = "Unavailable";
          return;
        }

        fetch(apis[apiIndex])
          .then(res => {
            if (!res.ok) throw new Error(res.status);
            return res.json();
          })
          .then(data => {
            const parts = [];
            if (data.city || data.country) parts.push(data.city || data.country);
            if (data.region) parts.push(data.region);
            if (data.country_name) parts.push(data.country_name);
            el.textContent = parts.join(", ") || "Unknown";
          })
          .catch(() => tryNext(apiIndex + 1));
      }

      tryNext();
    })();

    // Connection mode: HTTP / HTTPS + swap links
    (function showConnectionMode() {
      const modeEl = document.getElementById("connection-mode");
      const linksEl = document.getElementById("protocol-links");

      const isHttps = window.location.protocol === 'https:';
      const host = window.location.host || 'captive.ediflyer.net';

      modeEl.textContent = isHttps ? 'HTTPS' : 'HTTP';

      const httpUrl = 'http://' + host + window.location.pathname + window.location.search;
      const httpsUrl = 'https://' + host + window.location.pathname + window.location.search;

      linksEl.innerHTML = '';

      const httpLink = document.createElement('a');
      httpLink.href = httpUrl;
      httpLink.textContent = 'HTTP';
      if (!isHttps) httpLink.classList.add('active');

      const httpsLink = document.createElement('a');
      httpsLink.href = httpsUrl;
      httpsLink.textContent = 'HTTPS';
      if (isHttps) httpsLink.classList.add('active');

      linksEl.appendChild(httpLink);
      linksEl.appendChild(httpsLink);
    })();
  </script>
</body>
</html>
